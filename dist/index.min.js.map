{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///external \"ramda/src/is\"","webpack:///external \"react\"","webpack:///external \"@babel/runtime/helpers/extends\"","webpack:///external \"ramda/src/path\"","webpack:///external \"ramda/src/clone\"","webpack:///external \"ramda/src/pick\"","webpack:///external \"ramda/src/isEmpty\"","webpack:///external \"ramda/src/mergeDeepRight\"","webpack:///./src/util.js","webpack:///./src/index.js"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","target","source","path","isAsyncFunction","cb","constructor","inWhich","type","obj","transBool","flag","is","newObj","keys","forEach","item","StoreContext","React","createContext","LOADING","CACHE","asyncKey","newData","actionAsync","initialState","initStore","methodsName","doRun","actionArr","store","state","payload","res","args","Function","run","StoreProvider","props","middleware","console","error","hasLoadingMiddleware","filter","length","propsCacheExit","cache","isEmpty","localStorage","getItem","removeItem","mergeDeepRight","JSON","parse","origin_dispatch","useReducer","prevState","action","Array","Error","nextState","_key","reducer","newState","_state","clone","addEventListener","setItem","stringify","pick","Provider","dispatch","async","undefined","func","_action","children","useDispatchHook","useContext","useStateHook","useStoreHook","_store","_methods","methods","methodsArr","connect","mapStateToProps","mapDispatchToProps","Comp","rootState","Promise","resolve","reject","err","stateToProps","dispatchToProps"],"mappings":"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","file":"index.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","module.exports = require(\"ramda/src/is\");","module.exports = require(\"react\");","module.exports = require(\"@babel/runtime/helpers/extends\");","module.exports = require(\"ramda/src/path\");","module.exports = require(\"ramda/src/clone\");","module.exports = require(\"ramda/src/pick\");","module.exports = require(\"ramda/src/isEmpty\");","module.exports = require(\"ramda/src/mergeDeepRight\");","import is from 'ramda/src/is'\nimport path from 'ramda/src/path'\n\nexport function get(target, source) {\n  return path(target, source)\n}\n\nexport function run(target, source, ...args){\n  const res = get(target, source)\n  if(is(Function, res)){\n    return res(...args)\n  }\n  return undefined\n}\n\nexport function isAsyncFunction(cb){\n  if(!cb){\n    return false\n  }\n  return cb.constructor.name === 'AsyncFunction'\n}\n\n/**\n * 函数是否在effects/reducers/methods里面\n * @param {String} type  methods effects reducers \n * @param {Object} obj \n * @param {String} name \n */\nexport function inWhich(type, obj, name){\n  if(!obj){\n    return false\n  }\n\n  if(!obj[type]){\n    return false;\n  }\n\n  if (obj[type][name]) {\n    return true;\n  }\n}\n\nexport function transBool(obj, flag = true){\n  if(!is(Object, obj)){\n    return {}\n  }\n  \n  let newObj = {}\n  Object.keys(obj).forEach(item=>{\n    newObj[item] = flag\n  })\n  return newObj\n}\n","import React, { useContext, useReducer } from 'react'\nimport { get, run, isAsyncFunction, inWhich, transBool } from './util'\nimport is from 'ramda/src/is'\nimport clone from 'ramda/src/clone'\nimport pick from 'ramda/src/pick'\nimport isEmpty from 'ramda/src/isEmpty'\nimport mergeDeepRight from 'ramda/src/mergeDeepRight'\n\nconst StoreContext = React.createContext()\n\nconst LOADING = 'hook-loading-clear'\nconst CACHE = 'react-store:cache'\n\nlet initialState = {},\n  initStore = {}, //传入的store\n  asyncKey,\n  newData,\n  methodsName = {}, //所有方法名\n  actionAsync //触发的异步方法\n\nfunction doRun(key, actionArr, type, store, state, payload) {\n  let res\n  actionArr.forEach(item => {\n    if (get([key, item, type], store)) {\n      res = run([key, item, type], store, state, payload)\n    }\n  })\n  newData = res\n  return res\n}\n\nfunction reducer(state, action) {\n  const { key, type, payload } = action\n  const _key = key || asyncKey\n\n  return {\n    ...state,\n    [_key]: {\n      ...state[_key],\n      ...doRun(_key, ['methods', 'reducers', 'effects'], type, initStore, state[_key], payload)\n    }\n  }\n}\n\nfunction StoreProvider(props) {\n  const { store, middleware } = props;\n  if (!store) {\n    console.error(`\n      store 必须有值，类似于：\n      <StoreProvider store={store}>\n      `)\n    return null\n  }\n\n  const hasLoadingMiddleware = middleware.filter(item => item.name === 'loading').length\n  const propsCacheExit = props?.cache?.length\n\n  if (hasLoadingMiddleware) {\n    function setLoadingTrue() {\n      if (isEmpty(methodsName)) {\n        Object.keys(store).forEach(item => {\n          methodsName[item] = {\n            ...transBool(get([item, 'methods'], store), false),\n            ...transBool(get([item, 'reducers'], store), false),\n            ...transBool(get([item, 'effects'], store), false)\n          }\n        })\n      }\n    }\n    setLoadingTrue()\n  }\n\n  initStore = store\n\n  // 中间件\n  function middlewareReducer(prevState, action) {\n    if (!action) {\n      return store;\n    }\n\n    if (middleware) {\n      if (!is(Array, middleware)) {\n        throw new Error('middleware中间件必须为数组')\n      }\n    }\n\n    let nextState = reducer(prevState, action);\n\n    middleware && middleware.forEach(item => {\n      const newState = item(store, prevState, nextState, action, actionAsync, asyncKey, props?.cache)\n      if (newState) {\n        nextState = newState\n      }\n    })\n\n    return nextState;\n  }\n\n  Object.keys(initStore).forEach(item => {\n    initialState[item] = initStore[item]['state']\n  });\n\n  // 初始化-读取缓存\n  if (!propsCacheExit && localStorage.getItem(CACHE)) { // cache配置没有，但是有localStorage，需要清除\n    localStorage.removeItem(CACHE)\n  }\n  if (propsCacheExit && localStorage.getItem(CACHE)) {\n    initialState = mergeDeepRight(initialState, JSON.parse(localStorage.getItem(CACHE)))\n  }\n\n  if (hasLoadingMiddleware) {\n    initialState['loading'] = methodsName\n  }\n\n  const [state, origin_dispatch] = useReducer(middlewareReducer, initialState)\n  let _state = clone(state)\n\n  // 页面刷新时候缓存数据\n  propsCacheExit && window.addEventListener('beforeunload', () => {\n    localStorage.setItem(CACHE, JSON.stringify(pick(props.cache, _state)))\n  });\n\n\n  const dispatch = async (action, payload, key) => {\n    actionAsync = undefined\n\n    if (get([asyncKey, 'reducers', action.type], initStore)) {\n      return origin_dispatch(action);\n    }\n\n    if (!isAsyncFunction(action) && inWhich('effects', initStore[action.key || asyncKey], action.type)) {\n      asyncKey = action.key\n      actionAsync = action.type\n\n      if (hasLoadingMiddleware) {\n        origin_dispatch({\n          key: asyncKey,\n          type: LOADING,\n          payload: actionAsync\n        })\n      }\n\n      const func = get([action.key, 'effects', action.type], initStore)\n      return await func(origin_dispatch, _state, action.payload)\n    }\n\n    if (isAsyncFunction(action) || get([asyncKey, 'effects', action], initStore)) {\n      asyncKey = key\n      actionAsync = action.name\n\n      if (hasLoadingMiddleware) {\n        origin_dispatch({\n          key: asyncKey,\n          type: LOADING,\n          payload: action.name,\n        })\n      }\n\n      return await action(origin_dispatch, state, payload);\n    }\n\n    if (!isAsyncFunction(action) && is(Function, action)) {\n      if (is(Object, action())) {\n        const _action = get([action().key, 'methods', action().type], initStore) ||\n          get([action().key, 'effects', action().type], initStore)\n\n        if (is(Function, _action)) {\n          asyncKey = action().key\n          actionAsync = action().type\n\n          if (hasLoadingMiddleware) {\n            origin_dispatch({\n              key: asyncKey,\n              type: LOADING,\n              payload: actionAsync\n            })\n          }\n\n          return await _action(origin_dispatch, state, action().payload);\n        }\n      }\n    }\n\n    return origin_dispatch(action);\n  }\n\n  return (\n    <StoreContext.Provider value={{ state, dispatch }}>\n      {props.children}\n    </StoreContext.Provider>\n  );\n};\n\nfunction useDispatchHook(key) {\n  const store = useContext(StoreContext)\n  if (key) {\n    asyncKey = key\n  }\n  return store.dispatch\n}\n\nfunction useStateHook(key) {\n  const store = useContext(StoreContext)\n\n  return key ? get(['state', key], store) : get(['state'], store)\n}\n\n/*返回state和方法\n{\n  user: {id:1,getUser(state,payload){xxxx}}\n}\n*/\nfunction useStoreHook() {\n  const { state, dispatch } = useContext(StoreContext)\n  let _store = {}\n  Object.keys(state).forEach(key => {\n    let _methods = {}\n    const methods = {\n      ...get([key, 'methods'], initStore),\n      ...get([key, 'reducers'], initStore),\n      ...get([key, 'effects'], initStore)\n    }\n    const methodsArr = methods && Object.keys(methods)\n\n    is(Array, methodsArr) && methodsArr.forEach(item => {\n      if (isAsyncFunction(methods[item]) || inWhich('effects', initStore[key], item)) {\n        _methods[item] = async (payload) => {\n          await dispatch(methods[item], payload, key)\n        }\n      }\n\n      if (!isAsyncFunction(methods[item]) && is(Function, methods[item])) {\n        _methods[item] = (payload) => {\n          dispatch({\n            key: key,\n            type: item,\n            payload\n          })\n        }\n      }\n    })\n\n    _store[key] = {\n      ...state[key],\n      ..._methods\n    }\n  })\n\n  return _store\n}\n\nfunction connect(mapStateToProps, mapDispatchToProps) {\n  return function (Comp) {\n    return function (props) {\n      const store = useStoreHook()\n      const { state } = useContext(StoreContext)\n      const rootState = state\n      let methods = {}\n      Object.keys(store).forEach(item => {\n        // const _state = rootState[item]\n        methods[item] = {}\n        Object.keys(store[item]).forEach(i => {\n          if (is(Function, store[item][i])) {\n            if (isAsyncFunction(store[item][i]) || inWhich('effects', initStore[item], i)) {\n              methods[item][i] = function (dispatch, state, payload) {\n                return new Promise(async (resolve, reject) => {\n                  try {\n                    await store[item][i](dispatch, rootState, payload)\n                    resolve(newData)\n                  } catch (err) {\n                    reject(err)\n                  }\n                })\n              }\n            } else {\n              methods[item][i] = function (state, payload) {\n                return new Promise((resolve, reject) => {\n                  try {\n                    store[item][i](state, payload)\n                    resolve(state)\n                  } catch (err) {\n                    reject(err)\n                  }\n                })\n              }\n            }\n          }\n        })\n      })\n\n      const stateToProps = mapStateToProps(state)\n      const dispatchToProps = mapDispatchToProps(methods)\n\n      return <Comp {...stateToProps} {...dispatchToProps} {...props} />\n    }\n  }\n}\n\nexport {\n  StoreContext, StoreProvider, useStateHook, useDispatchHook, useStoreHook, connect\n}\n"],"sourceRoot":""}